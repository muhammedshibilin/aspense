<!doctype html>
<html class="no-js" lang="en">

    <head>
        <meta charset="utf-8">
        <meta http-equiv="x-ua-compatible" content="ie=edge">
        <title>aspens</title>
        <meta name="robots" content="noindex, follow" />
        <meta name="description" content>
        <meta name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- Favicon -->
        <link rel="shortcut icon" type="image/x-icon"
            href="user/images/favicon.ico">

        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="user/css/vendor/bootstrap.min.css">
        <link rel="stylesheet" href="user/css/plugins/plugins.css">

        <!-- Main Style CSS -->
        <link rel="stylesheet" href="user/css/style.css">
        <!--<link rel="stylesheet" href="user/css/style.min.css">-->
        <style>
        /* Custom styles */
        body {
            background-color: #f8f9fa;
            /* Light background color */
        }

        .page-title-box {
            background-color: #007bff;
            /* Blue background for the title box */
            color: white;
            /* White text for the title */
            padding: 10px;
            border-radius: 5px;
        }

        .add-review-button {
            background-color: #28a745;
            /* Green background for the button */
            color: white;
            /* White text for the button */
        }

        .table-bordered {
            border-color: #6c757d;
            /* Gray border for the table */
        }

        .table-bordered th,
        .table-bordered td {
            border-color: #6c757d;
            /* Gray border for table cells */
        }

        .card {
            border-color: #6c757d;
            /* Gray border for cards */
        }

        .card-body {
            background-color: #e9ecef;
            /* Light gray background for card bodies */
        }

        .header-title {
            color: #007bff;
            /* Blue text for headers */
        }

        .font-family-primary {
            color: #28a745;
            /* Green text for shipping information */
        }

        /* Center align tables */
        .table-centered {
            margin: 0 auto;
            /* Center horizontally */
            float: none;
            /* Clear float */
        }
    </style>

    </head>

    <body>

        <!-- Start Header -->
        <header
            class="header-area haeder-default header--transparent black-logo-version ptb_lg--40 ptb_md--40 ptb_sm--30">
            <div class="header-wrapper container  bg-gradient ">
                <div class="row align-items-center">
                    <!-- Start Header Left -->
                    <div class="col-xl-2 col-lg-6 col-md-6 col-sm-6 col-6">
                        <div class="logo">
                            <a href="/">
                                <img src="user/images/logo/logo-black.png"
                                    alt="Draven logo">
                            </a>
                        </div>
                    </div>
                    <!-- Start Header Center -->
                    <div class="col-xl-9 d-none d-xl-block">
                        <nav class="mainmenu__nav position-fixed ">
                            <!-- Start Mainmanu Nav -->
                            <ul class="primary-menu megamenu-wrapper">
                                <li><a href="/">Home</a>
                                </li>
                                <li><a href="/about">About</a></li>
                                <li class="lavel-1"><a href="/shop">Shop</a>
                                    <ul class="dropdown__menu">
                                        <li><a
                                                href="/shop"><span>Shop</span></a></li>
                                        <li><a
                                                href="/shop-left-sidebar"><span>Shop
                                                    Left Sidebar</span></a></li>
                                        <li><a
                                                href="/shop-right-sidebar"><span>Shop
                                                    No Sidebar</span></a></li>
                                        <li><a
                                                href="/product-details"><span>Product
                                                    Details</span></a></li>
                                    </ul>
                                </li>
                                <li><a href="/blog">Blog</a>
                                    <!-- <ul class="dropdown__menu">
                                    <li><a href="blog.html"><span>Blog</span></a></li>
                                    <li><a href="blog-left-sidebar.html"><span>Blog Left Sidebar</span></a></li>
                                    <li><a href="blog-details.html"><span>Blog Details</span></a></li>
                                </ul> -->
                                </li>
                                <li class="lavel-1"><a href="#">Pages</a>
                                    <ul class="dropdown__menu">
                                        <li><a
                                                href="/cart"><span>Cart</span></a></li>
                                        <li><a
                                                href="/checkout"><span>Checkout</span></a></li>
                                        <li><a
                                                href="/wishlist"><span>Wishlist</span></a></li>
                                        <li><a
                                                href="/compare"><span>Compare</span></a></li>
                                        <li><a href="/my-account"><span>My
                                                    Account</span></a></li>
                                        <li><a
                                                href="/login"><span>Login</span></a></li>
                                        <li><a href="/sign-up"><span>sign
                                                    Up</span></a></li>
                                    </ul>
                                </li>
                                <li><a href="/contact">Contact</a></li>

                            </ul>
                            <!-- End Mainmanu Nav -->
                        </nav>
                    </div>
                    <!-- Start Header Right -->

                </div>
            </div>
        </header>
        <!-- End Header -->

        <!-- Content -->
        <div class="content  " style="margin-top: 10rem;">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-8">
                        <div class="card">
                            <div class="card-body">
                                <!-- <div class="invoice d-flex justify-content-end">
                                    <a href="#">
                                        <button id="Invoice"
                                            class="add-review-button btn btn-info">
                                            <i class="fas fa-download"></i>
                                            Invoice
                                        </button>
                                    </a>
                                </div> -->

                                <h4 class="header-title mb-3"></h4>
                                <div class="table-responsive">
                                    <table
                                        class="table table-bordered table-centered mb-0">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Product id</th>
                                                <th>Image</th>
                                                <th>Quantity</th>
                                                <th>Product Price</th>
                                                <th>Total</th>
                                                <th>Status</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <% order.forEach( orderItem => { %>
                                            <% orderItem.products.forEach(
                                            product => { %>
                                            <tr>
                                               
                                                <td><%= product._id %></td>
                                                <td><img
                                                        src="/images/product/original/<%= product.productId %>.jpg"
                                                        alt="Product Image"
                                                        width="50"
                                                        height="50"></td>
                                               
                                                <td><%= product.count %></td>
                                                <td>$<%= product.productPrice
                                                    %>.00</td>
                                                <td>$<%= product.totalPrice
                                                    %>.00</td>
                                                <td><%= product.status %></td>
                                                <td>

                                                    <% if (product.status !==
                                                    "Cancelled" &&
                                                    product.status !==
                                                    "Delivered"
                                                    && product.status !==
                                                    "request" && product.status
                                                    !== "Accepted" &&
                                                    product.status !=="Pending")
                                                    { %>
                                                    <button type="button"
                                                        onclick="cancelProduct('<%= product._id %>', '<%= orderItem._id %>')"
                                                        class="btn"
                                                        style="color: rgb(249, 249, 249); background-color:  #ce3f3f;">Cancel</button>
                                                    <% } else if (product.status
                                                    == "Delivered") { %>
                                                    <button type="button"
                                                        class="btn "
                                                        id="requestStatus"
                                                        onclick="returnRequest('<%= product._id %>','<%= order._id %>')"
                                                        style="background-color: #e66a35; color: rgb(239, 190, 167)">Return</button>
                                                    <% } else if (product.status
                                                    == "Accepted") { %>
                                                    <label
                                                        style="color: red;">OrderReturned</label>
                                                    <% } else if (product.status
                                                    == "request") { %>
                                                    <label
                                                        style="color: rgb(221, 221, 27);">Requested</label>
                                                    <% } else if (product.status
                                                    == "Cancelled") { %>
                                                    <label
                                                        style="color: rgb(221, 27, 27);">Cancelled</label>
                                                    <% } else if (product.status
                                                    == "Pending") { %>
                                                    <label
                                                        style="color: red;">Failed</label>

                                                    <% } else { %>
                                                    <label
                                                        style="color: red;">Requested</label>
                                                    <% } %>
                                                </td>
                                            </tr>
                                            <% }); %>
                                            <% }); %>
                                        </tbody>
                                        <tfoot>
                                            <tr>
                                                <th colspan="6"
                                                    class="text-right">Shipping
                                                    Charge :</th>
                                                <td>$<%= order[0].shippingAmount
                                                    %>.00</td>
                                                
                                            </tr>
                                            <tr>
                                                <th colspan="6"
                                                    class="text-right">Total
                                                    :</th>
                                                <td>$<%= order[0].totalAmount
                                                    %>.00</td>
                                         
                                            </tr>
                                        </tfoot>
                                    </table>

                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="col-lg-4">
                        <div class="row">
                            <div class="col-lg-12">
                                <div class="card">
                                    <div class="card-body">
                                        <h4 class="header-title mb-3">Shipping
                                            Information</h4>
                                        <h5
                                            class="font-family-primary fw-semibold"><%=
                                            order[0].deliveryDetails.fullName
                                            %></h5>
                                        <p>Address: <%=
                                            order[0].deliveryDetails.houseName
                                            %>, <%=
                                            order[0].deliveryDetails.city %>,
                                            <%= order[0].deliveryDetails.state
                                            %>, <%= order[0].deliveryDetails.pin
                                            %></p>
                                        <p>Phone: <%=
                                            order[0].deliveryDetails.mobile
                                            %></p>
                                    </div>
                                </div>
                            </div>
                            <div class="col-lg-12 mt-4">
                                <div class="card">
                                    <div class="card-body">
                                        <% order.forEach(function(orderItem) {
                                        %>
                                        <h4 class="header-title mb-3">Order
                                            Summary</h4>
                                        <ul>
                                            <li>Order ID : <%= orderItem.orderId
                                                %></li>
                                            <li>Date : <%= new
                                                Date(orderItem.date).toLocaleDateString()
                                                %></li>
                                            <li>Payment Method : <%=
                                                orderItem.paymentMethod %></li>
                                            <li>Total Amount: <%=
                                                orderItem.totalAmount %></li>
                                        </ul>
                                        <% }); %>

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

      
        <script
            src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

            <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

            <script>

function cancelProduct(orderProductId, orderId) {
        console.log('orderProductId',orderProductId,orderId);
    Swal.fire({
        title: "Are you sure?",
        text: "You want to cancel this Order?",
        icon: "warning",
        showCancelButton: true,
        confirmButtonColor: "#3085d6",
        cancelButtonColor: "#d33",
        confirmButtonText: "Yes",
        cancelButtonText: "Not now",
    }).then((result) => {
        if (result.isConfirmed) {
               $.ajax({
                    url: "/cancel-order",
                    data: { productId: orderProductId, orderId: orderId },
                    method: "post",
                    success: (response) => {
                        console.log("jksdnckjs");
                        if (response.success) {

                            Swal.fire({
                                icon: 'success',
                                title: 'Order Cancelled.',
                                showConfirmButton: false,
                                timer: 2000
                            }).then(() => {
                                location.reload();
                            });
                        }
                    }
                })
            };
            });
        }





</script>

            </script>
    

            <%- include('../layouts/user/footer.ejs') %>
