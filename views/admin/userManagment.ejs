<%- include("../layouts/admin/header.ejs") %>

<div class="main-panel">
    <div class="content-wrapper">
        <div class="row">
            <div class="col-lg-12 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <h4
                            class="card-title  d-flex  justify-content-center  ">
                            User Managment
                        </h4>
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>
                                            No:
                                        </th>
                                        <th>
                                            customer name
                                        </th>
                                        <th>
                                            email
                                        </th>
                                        <th>
                                            contact
                                        </th>
                                        <!-- <th>
                                                            image
                                                        </th> -->
                                        <th>
                                            status
                                        </th>
                                        <th>
                                            action
                                        </th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <% if (users.length > 0) { %>
                                    <% let counter = 1; %>
                                    <% users.forEach(user => { %>
                                    <tr>
                                        <td class="py-1"> <%= counter %> </td>
                                        <td class="py-1"> <%= user.name %> </td>
                                        <td class="py-1"> <%= user.email %>
                                        </td>
                                        <td class="py-1"> <%= user.mobile %>
                                        </td>
                                        <td>
                                            <% if (user.is_verified == 0) { %>
                                            <p>not verified</p>
                                            <% } else { %>
                                            <p>verified</p>
                                            <% } %>
                                        </td>
                                        <td>
                                            <% if (user.is_block == 0) { %>
                                            <button
                                                onclick="blockUser('<%= user._id %>')"><a
                                                    class="badge badge-success">BLOCK
                                                    USER</a></button>
                                            <% } else { %>
                                            <button
                                                onclick="blockUser('<%= user._id %>')"><a
                                                    class="badge badge-danger">UNBLOCK</a></button>
                                            <% } %>
                                        </td>
                                    </tr>
                                    <% counter++; %>
                                    <% }); %>
                                    <% } else { %>
                                    <tr>
                                        <td colspan="6">User not found</td>
                                    </tr>
                                    <% } %>

                                    <script>
                                         function blockUser(userId){
            swal
        .fire({
          title: "Are You Sure?",
          Text: "Are You Sure?",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#3085d6",
          cancelButtonColor: "#d33",
          confirmButtonText: "Yes",
          cancelButtonText: "cancel",
        })
        .then((result) => {
          if (result.isConfirmed) {
            $.ajax({
              url: "/admin/block-user",
              data: {
                userId: userId,
              },
              method: "post",
              success: (response) => {
                if ((response.remove = true)) {
                  location.reload();
                  swal.fire({
                    title: "Done",
                    text: "Suscces",
                    icon: "Suscces",
                    timer: 1500,
                    showConfirmButton: false,
                  });
                }
              },
            });
          }
        });
          }
                                    </script>

                                    <script
                                        src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
                                    <script
                                        src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

                                    <%- include("../layouts/admin/footer.ejs")
                                    %>