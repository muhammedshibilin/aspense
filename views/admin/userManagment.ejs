<!DOCTYPE html>
<html lang="en">

<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>ASPENSE</title>
  <!-- base:css -->
  <link rel="stylesheet" href="vendors/mdi/css/materialdesignicons.min.css">
  <link rel="stylesheet" href="vendors/feather/feather.css">
  <link rel="stylesheet" href="vendors/base/vendor.bundle.base.css">
  <!-- endinject -->
  <!-- inject:css -->
  <link rel="stylesheet" href="css/style.css">
  <!-- endinject -->
  <link rel="shortcut icon" href="images/logogo-removebg-preview.png" />
 
</head>

<body>
  <div class="container-scroller">
    <!-- partial:partials/_navbar.html -->
    <nav class="navbar col-lg-12 col-12 p-0 fixed-top d-flex flex-row">
      <div class="text-center navbar-brand-wrapper d-flex align-items-center justify-content-center">
        <a class="navbar-brand brand-logo" href="index.html"><img src="images/logo.png" alt="logo" style="height: 30px;"  /></a>
        <a class="navbar-brand brand-logo-mini" href="index.html"><img src="images/logogo-removebg-preview.png" alt="logo"/></a>
      </div>
                    <div
                        class="navbar-menu-wrapper d-flex align-items-center justify-content-end">
                        <button
                            class="navbar-toggler navbar-toggler align-self-center"
                            type="button" data-toggle="minimize">
                            <span class="icon-menu"></span>
                        </button>
                        <ul class="navbar-nav">
                            <li class="nav-item nav-search">
                                <div class="input-group">
                                    <div class="input-group-prepend">
                                        <span class="input-group-text"
                                            id="search">
                                            <i class="icon-search"></i>
                                        </span>
                                    </div>
                                    <input type="text" class="form-control"
                                        id="searchinput"
                                        placeholder="Search users....."
                                        aria-label="search"
                                        aria-describedby="search">
                                </div>
                            </li>
                        </ul>
                        <ul class="navbar-nav navbar-nav-right">
                            <li class="nav-item dropdown d-lg-flex d-none">
                                <button type="button"
                                    class="btn btn-info font-weight-bold">+
                                    Create New</button>
                            </li>
                            <li class="nav-item dropdown d-flex">
                                <a
                                    class="nav-link count-indicator dropdown-toggle d-flex justify-content-center align-items-center"
                                    id="messageDropdown" href="#"
                                    data-toggle="dropdown">
                                    <i class="icon-air-play mx-0"></i>
                                </a>
                                <div
                                    class="dropdown-menu dropdown-menu-right navbar-dropdown preview-list"
                                    aria-labelledby="messageDropdown">
                                    <p
                                        class="mb-0 font-weight-normal float-left dropdown-header">Messages</p>
                                    <a class="dropdown-item preview-item">
                                        <div class="preview-thumbnail">
                                            <img src="images/faces/face4.jpg"
                                                alt="image" class="profile-pic">
                                        </div>
                                        <div
                                            class="preview-item-content flex-grow">
                                            <h6
                                                class="preview-subject ellipsis font-weight-normal">shibili
                                            </h6>
                                            <p
                                                class="font-weight-light small-text text-muted mb-0">
                                                The meeting is cancelled
                                            </p>
                                        </div>
                                    </a>
                                    <a class="dropdown-item preview-item">
                                        <div class="preview-thumbnail">
                                            <img src="images/faces/face2.jpg"
                                                alt="image" class="profile-pic">
                                        </div>
                                        <div
                                            class="preview-item-content flex-grow">
                                            <h6
                                                class="preview-subject ellipsis font-weight-normal">Tim
                                                Cook
                                            </h6>
                                            <p
                                                class="font-weight-light small-text text-muted mb-0">
                                                New product launch
                                            </p>
                                        </div>
                                    </a>
                                    <a class="dropdown-item preview-item">
                                        <div class="preview-thumbnail">
                                            <img src="images/faces/face3.jpg"
                                                alt="image" class="profile-pic">
                                        </div>
                                        <div
                                            class="preview-item-content flex-grow">
                                            <h6
                                                class="preview-subject ellipsis font-weight-normal">
                                                Johnson
                                            </h6>
                                            <p
                                                class="font-weight-light small-text text-muted mb-0">
                                                Upcoming board meeting
                                            </p>
                                        </div>
                                    </a>
                                </div>
                            </li>
                            <li class="nav-item dropdown d-flex mr-4 ">
                                <a
                                    class="nav-link count-indicator dropdown-toggle d-flex align-items-center justify-content-center"
                                    id="notificationDropdown" href="#"
                                    data-toggle="dropdown">
                                    <i class="icon-cog"></i>
                                </a>
                                <div
                                    class="dropdown-menu dropdown-menu-right navbar-dropdown preview-list"
                                    aria-labelledby="notificationDropdown">
                                    <p
                                        class="mb-0 font-weight-normal float-left dropdown-header">Settings</p>
                                    <a class="dropdown-item preview-item">
                                        <i class="icon-head"></i> Profile
                                    </a>
                                    <a class="dropdown-item preview-item">
                                        <i class="icon-inbox"></i> Logout
                                    </a>
                                </div>
                            </li>
                            <li class="nav-item dropdown mr-4 d-lg-flex d-none">
                                <a
                                    class="nav-link count-indicatord-flex align-item s-center justify-content-center"
                                    href="#">
                                    <i class="icon-grid"></i>
                                </a>
                            </li>
                        </ul>
                        <button
                            class="navbar-toggler navbar-toggler-right d-lg-none align-self-center"
                            type="button" data-toggle="offcanvas">
                            <span class="icon-menu"></span>
                        </button>
                    </div>
                </nav>
                <!-- partial -->

                <%- include("../layouts/admin/sidebar.ejs") %>

                <div class="main-panel">
                    <div class="content-wrapper">
                        <div class="row">

                            <div class="col-lg-12 grid-margin stretch-card">
                                <div class="card">
                                    <div class="card-body">
                                        <h4
                                            class="card-title d-flex justify-content-center">
                                            User Management
                                        </h4>
                                        <div class="table-responsive">
                                            <table class="table table-striped" id="usersTable">
                                                <thead>
                                                    <tr>
                                                        <th>No:</th>
                                                        <th>Customer Name</th>
                                                        <th>Email</th>
                                                        <th>Contact</th>
                                                        <th>Status</th>
                                                        <th>Action</th>
                                                    </tr>
                                                </thead>
                                                <tbody>
                                                    <% if (users.length > 0) {
                                                    %>
                                                    <% let counter = 1; %>
                                                    <% users.forEach(user => {
                                                    %>
                                                    <tr>
                                                        <td class="py-1"><%=
                                                            counter %></td>
                                                        <td class="py-1"><%=
                                                            user.name %></td>
                                                        <td class="py-1"><%=
                                                            user.email %></td>
                                                        <td class="py-1"><%=
                                                            user.mobile %></td>
                                                        <td>
                                                            <% if
                                                            (user.is_verified ==
                                                            0) { %>
                                                            <p>Not Verified</p>
                                                            <% } else { %>
                                                            <p>Verified</p>
                                                            <% } %>
                                                        </td>
                                                        <td>
                                                            <% if (user.is_block
                                                            == 0) { %>
                                                            <button
                                                                onclick="blockUser('<%= user._id %>')">
                                                                <a
                                                                    class="badge badge-success">BLOCK
                                                                    USER</a>
                                                            </button>
                                                            <% } else { %>
                                                            <button
                                                                onclick="blockUser('<%= user._id %>')">
                                                                <a
                                                                    class="badge badge-danger">UNBLOCK</a>
                                                            </button>
                                                            <% } %>
                                                        </td>
                                                    </tr>
                                                    <% counter++; %>
                                                    <% }); %>
                                                    <% } else { %>
                                                    <tr>
                                                        <td colspan="6">User not
                                                            found</td>
                                                    </tr>
                                                    <% } %>
                                                </tbody>
                                            </table>
                                        </div>
                                    </div>
                                    <div class="dropdown">
                                        <button class="dropdown-button">filter</button>
                                        <div class="dropdown-content">
                                            <a href="#" id="sortAtoZ">A-Z</a>
                                            <a href="#" id="sortZtoA">Z-A</a>
                                        </div>
                                    </div>
                                </div>

                            </div>

                        </div>
                        <div class="pagination">
                            <a id="prevPage">&laquo; Previous</a>
                            <span id="pageNumbers"></span>
                            <a id="nextPage">Next &raquo;</a>
                        </div>

                    </div>

                    <script>
                                         function blockUser(userId){
            swal
        .fire({
          title: "Are You Sure?",
          Text: "Are You Sure?",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#3085d6",
          cancelButtonColor: "#d33",
          confirmButtonText: "Yes",
          cancelButtonText: "cancel",
        })
        .then((result) => {
          if (result.isConfirmed) {
            $.ajax({
              url: "/admin/block-user",
              data: {
                userId: userId,
              },
              method: "post",
              success: (response) => {
                if ((response.remove = true)) {
                  location.reload();
                  swal.fire({
                    title: "Done",
                    text: "Suscces",
                    icon: "Suscces",
                    timer: 1500,
                    showConfirmButton: false,
                  });
                }
              },
            });
          }
        });
          }
                                    </script>

                    <script
                        src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>

                    <script
                        src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
                    <script>
                        

$(document).ready(function () {
    $('[data-toggle="dropdown"]').dropdown();
});

let currentPage = 0;
let pageSize = 6;
const users = JSON.parse('<%- JSON.stringify(users) %>');

function* paginateUsers(users, pageSize, currentPage) {
    const start = currentPage * pageSize;
    const end = start + pageSize;
    const pageUsers = users.slice(start, end);
    if (pageUsers.length > 0) {
        yield pageUsers;
    }
}

function updatePagination(usersToDisplay) {
    const totalPages = Math.ceil(usersToDisplay.length / pageSize);
    $('#pageNumbers').text(`Page ${currentPage + 1} of ${totalPages}`);
    $('#prevPage').prop('disabled', currentPage === 0);
    $('#nextPage').prop('disabled', currentPage >= totalPages - 1);

    $('tbody').empty();

    const paginationGenerator = paginateUsers(usersToDisplay, pageSize, currentPage);
    const nextPage = paginationGenerator.next();
    if (!nextPage.done) {
        nextPage.value.forEach((user, index) => {
            $('tbody').append(`
                <tr>
                    <td class="py-1">${index + 1}</td>
                    <td class="py-1">${user.name}</td>
                    <td class="py-1">${user.email}</td>
                    <td class="py-1">${user.mobile}</td>
                    <td>${user.is_verified ? 'Verified' : 'Not Verified'}</td>
                    <td>
                        <button onclick="blockUser('${user._id}')">
                            <a class="${user.is_block ? 'badge badge-danger' : 'badge badge-success'}">${user.is_block ? 'UNBLOCK' : 'BLOCK'} USER</a>
                        </button>
                    </td>
                </tr>
            `);
        });
    }
}

function sortUsersAlphabetically(direction) {
    const sortedUsers = users.sort((a, b) => {
        if (direction === 'asc') {
            return a.name.localeCompare(b.name);
        } else {
            return b.name.localeCompare(a.name);
        }
    });

    updatePagination(sortedUsers);
}

document.getElementById('sortAtoZ').addEventListener('click', () => sortUsersAlphabetically('asc'));
document.getElementById('sortZtoA').addEventListener('click', () => sortUsersAlphabetically('desc'));

$('#prevPage').click(function() {
    if (currentPage > 0) {
        currentPage--;
        updatePagination(users); 
    }
});

$('#nextPage').click(function() {
    if (currentPage < Math.ceil(users.length / pageSize) - 1) {
        currentPage++;
        updatePagination(users); 
    }
});


updatePagination(users);
                        </script>




<script src="vendors/base/vendor.bundle.base.js"></script>
<script src="js/off-canvas.js"></script>
<script src="js/hoverable-collapse.js"></script>
<script src="js/template.js"></script>

<%- include('../layouts/admin/footer.ejs') %>